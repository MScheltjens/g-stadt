generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
}

////////////////////
/// GLOBAL ENUMS ///
////////////////////

enum Role {
    citizen
    staff
    admin
}

enum Locale {
    en
    fr
    de
}

enum CategoryType {
    service
    contact
}

////////////////////
/// AUTH & CORE ///
////////////////////

model User {
    id           String   @id @default(uuid())
    email        String   @unique
    passwordHash String
    role         Role     @default(citizen)
    isVerified   Boolean  @default(false)
    createdAt    DateTime @default(now())

    refreshTokens       RefreshToken[]
    passwordResetTokens PasswordResetToken[]
}

model RefreshToken {
    id        String   @id @default(uuid())
    tokenHash String
    userId    String
    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    expiresAt DateTime
}

model PasswordResetToken {
    id        String   @id @default(uuid())
    userId    String
    tokenHash String
    expiresAt DateTime

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@index([expiresAt])
}

////////////////////
/// CONTENT CORE ///
////////////////////

model Category {
    id       String       @id @default(uuid())
    code     String       @unique
    type     CategoryType
    order    Int          @default(0)
    isActive Boolean      @default(true)

    services     Service[]
    contacts     Contact[]
    translations CategoryTranslation[]

    @@index([isActive])
    @@index([type])
}

model CategoryTranslation {
    id         String @id @default(uuid())
    categoryId String
    locale     Locale

    label String
    slug  String

    category Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

    @@unique([categoryId, locale])
    @@unique([locale, slug])
}

model Service {
    id           String   @id @default(uuid())
    categoryId   String
    icon         String
    externalUrl  String?
    order        Int      @default(0)
    isActive     Boolean  @default(true)
    requiresAuth Boolean  @default(false)
    role         Role?
    createdAt    DateTime @default(now())
    updatedAt    DateTime @updatedAt

    category     Category             @relation(fields: [categoryId], references: [id])
    translations ServiceTranslation[]

    @@unique([categoryId, order]) // For upsert by category and order
    @@index([categoryId, isActive, order])
}

model ServiceTranslation {
    id          String @id @default(uuid())
    serviceId   String
    locale      Locale
    title       String
    description String
    slug        String

    service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

    @@unique([serviceId, locale])
    @@unique([locale, slug])
}

model Contact {
    id           String   @id @default(uuid())
    categoryId   String
    icon         String
    externalUrl  String?
    order        Int      @default(0)
    isActive     Boolean  @default(true)
    requiresAuth Boolean  @default(false)
    role         Role?
    createdAt    DateTime @default(now())
    updatedAt    DateTime @updatedAt

    category     Category             @relation(fields: [categoryId], references: [id])
    translations ContactTranslation[]

    @@unique([categoryId, order]) // For upsert by category and order
    @@index([categoryId, isActive, order])
}

model ContactTranslation {
    id          String @id @default(uuid())
    contactId   String
    locale      Locale
    title       String
    description String
    slug        String

    contact Contact @relation(fields: [contactId], references: [id], onDelete: Cascade)

    @@unique([contactId, locale])
    @@unique([locale, slug])
}

// 4 example categories for city website contact form
// 1. General Inquiry
// 2. Technical Support
// 3. Feedback
// 4. Report an Issue
