generator zod {
  provider                         = "zod-prisma-types"
  output                           = "../../types/src/generated"
  useMultipleFiles                 = false
  createInputTypes                 = false
  addInputTypeValidation           = false
  createModelTypes                 = true
  createOptionalDefaultValuesTypes = true
  createRelationValuesTypes        = false
  createPartialTypes               = false
  useDefaultValidators             = false
  coerceDate                       = false
}

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

////////////////////
/// GLOBAL ENUMS ///
////////////////////

enum Role {
  CITIZEN
  STAFF
  ADMIN
}

enum Locale {
  en
  fr
  de
}

////////////////////
/// AUTH & CORE ///
////////////////////

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String
  role         Role     @default(CITIZEN)
  isVerified   Boolean  @default(false)
  createdAt    DateTime @default(now())

  refreshTokens RefreshToken[]
  comments      Comment[]
  appointments  Appointment[]
  notifications Notification[]
  auditLogs     AuditLog[]
  pollResponses PollResponse[]
}

model RefreshToken {
  id        String   @id @default(uuid())
  tokenHash String
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
}

////////////////////
/// CONTENT CORE ///
////////////////////

////////////////////
/// CONTACT ///
////////////////////
model Contact {
  id        String   @id @default(uuid())
  name      String
  email     String
  message   String
  createdAt DateTime @default(now())
}

////////////////////
/// POLL ///
////////////////////
model Poll {
  id        String         @id @default(uuid())
  question  String
  isActive  Boolean        @default(true)
  createdAt DateTime       @default(now())
  options   PollOption[]
  responses PollResponse[]
}

model PollOption {
  id        String         @id @default(uuid())
  pollId    String
  text      String
  poll      Poll           @relation(fields: [pollId], references: [id], onDelete: Cascade)
  responses PollResponse[]
}

model PollResponse {
  id        String     @id @default(uuid())
  pollId    String
  optionId  String
  userId    String?
  poll      Poll       @relation(fields: [pollId], references: [id], onDelete: Cascade)
  option    PollOption @relation(fields: [optionId], references: [id], onDelete: Cascade)
  user      User?      @relation(fields: [userId], references: [id])
  createdAt DateTime   @default(now())
}

////////////////////
/// GALLERY ///
////////////////////

model Gallery {
  id          String         @id @default(uuid())
  title       String
  description String?
  createdAt   DateTime       @default(now())
  images      GalleryImage[]
}

model GalleryImage {
  id        String  @id @default(uuid())
  galleryId String
  url       String
  caption   String?
  gallery   Gallery @relation(fields: [galleryId], references: [id], onDelete: Cascade)
}

model Comment {
  id          String    @id @default(uuid())
  content     String
  authorId    String?
  author      User?     @relation(fields: [authorId], references: [id])
  parentId    String?
  parent      Comment?  @relation("CommentToComment", fields: [parentId], references: [id])
  children    Comment[] @relation("CommentToComment")
  createdAt   DateTime  @default(now())
  relatedType String
  relatedId   String
}

model Appointment {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  serviceId String
  service   Service  @relation(fields: [serviceId], references: [id])
  date      DateTime
  status    String   @default("pending")
  createdAt DateTime @default(now())
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  type      String
  content   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
}

model AuditLog {
  id        String   @id @default(uuid())
  userId    String?
  user      User?    @relation(fields: [userId], references: [id])
  action    String
  target    String
  timestamp DateTime @default(now())
  details   String?
}

enum EventCategory {
  music
  sports
  culture
  education
  community
  health
  environment
  technology

  // Add more categories as needed
}

model Event {
  id        String        @id @default(uuid())
  date      DateTime
  category  EventCategory
  imageUrl  String?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  translations EventTranslation[]
}

model EventTranslation {
  id          String @id @default(uuid())
  eventId     String
  locale      Locale
  title       String
  description String
  location    String
  slug        String

  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([eventId, locale])
  @@unique([locale, slug])
}

enum NewsCategory {
  local
  politics
  economy
  culture
  sports
  technology
  health
  environment
  education
  // Add more categories as needed
}

model News {
  id          String       @id @default(uuid())
  category    NewsCategory
  imageUrl    String?
  published   Boolean      @default(false)
  publishedAt DateTime?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  translations NewsTranslation[]
}

model NewsTranslation {
  id      String @id @default(uuid())
  newsId  String
  locale  Locale
  title   String
  content String
  excerpt String
  slug    String

  news News @relation(fields: [newsId], references: [id], onDelete: Cascade)

  @@unique([newsId, locale])
  @@unique([locale, slug])
}

enum ServiceCategory {
  citizen_services
  city_administration
  transport_mobility
  waste_environment
  family_social
  education_culture
  economy_business
  public_order_safety
  health
  housing_building
  leisure_tourism
  digital_city_hall
}

// Add more categories as needed

model Service {
  id String @id @default(uuid())

  /**
   * Domain
   */
  category ServiceCategory
  icon     String
  link     String? // external link or fallback
  order    Int             @default(0)

  /**
   * Visibility & access
   */
  isActive     Boolean @default(true)
  requiresAuth Boolean @default(false)
  role         Role? // null = public

  /**
   * Relations
   */
  translations ServiceTranslation[]
  appointments Appointment[]

  /**
   * Metadata
   */
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category])
  @@index([isActive])
}

model ServiceTranslation {
  id String @id @default(uuid())

  serviceId String
  locale    Locale

  title       String
  description String
  slug        String

  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@unique([serviceId, locale])
  @@unique([locale, slug])
}

model Page {
  id        String   @id @default(uuid())
  updatedAt DateTime @updatedAt

  translations PageTranslation[]
}

model PageTranslation {
  id      String @id @default(uuid())
  pageId  String
  locale  Locale
  title   String
  slug    String
  content String

  page Page @relation(fields: [pageId], references: [id], onDelete: Cascade)

  @@unique([pageId, locale])
  @@unique([locale, slug])
}

enum FAQCategory {
  general
  technical
  billing
  account
  services
  policies
  // Add more categories as needed
}

model FAQ {
  id       String       @id @default(uuid())
  category FAQCategory?
  order    Int?

  translations FAQTranslation[]
}

model FAQTranslation {
  id       String @id @default(uuid())
  faqId    String
  locale   Locale
  question String
  answer   String

  faq FAQ @relation(fields: [faqId], references: [id], onDelete: Cascade)

  @@unique([faqId, locale])
}

model Announcement {
  id        String   @id @default(uuid())
  type      String
  startDate DateTime
  endDate   DateTime
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())

  translations AnnouncementTranslation[]
}

model AnnouncementTranslation {
  id             String @id @default(uuid())
  announcementId String
  locale         Locale
  title          String
  content        String

  announcement Announcement @relation(fields: [announcementId], references: [id], onDelete: Cascade)

  @@unique([announcementId, locale])
}

enum DocumentCategory {
  policy
  form
  guide
  report
  // Add more categories as needed
}

model Document {
  id         String           @id @default(uuid())
  fileUrl    String
  category   DocumentCategory
  uploadedAt DateTime         @default(now())

  translations DocumentTranslation[]
}

model DocumentTranslation {
  id          String  @id @default(uuid())
  documentId  String
  locale      Locale
  title       String
  description String?

  document Document @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@unique([documentId, locale])
}

model Location {
  id           String  @id @default(uuid())
  type         String
  address      String
  openingHours String?
  imageUrl     String?

  translations LocationTranslation[]
}

model LocationTranslation {
  id          String @id @default(uuid())
  locationId  String
  locale      Locale
  name        String
  description String

  location Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@unique([locationId, locale])
}
